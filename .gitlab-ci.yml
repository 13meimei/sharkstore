variables:
    PROJECT_DIR: $PWD

before_script:
    - echo ${PROJECT_DIR}
    - gcc --version && go version
    - if [ ! -d "${PROJECT_DIR}/data-server/build/"  ];then
    -     mkdir ${PROJECT_DIR}/data-server/build/
    - fi

stages:
- build
- test
- deploy

build_sharkstore:
  stage: build
  script:
  - echo "build sharkstore data-server....."

  - cd ${PROJECT_DIR}/data-server/build/ &&
    cmake .. -DCMAKE_BUILD_TYPE=Debug -DBUILD_TEST=ON -DBUILD_TOOL=ON &&
    make

  - echo "build sharkstore gateway"
  - echo "done"

test_sharkstore_ds:
  stage: test
  script:
  - echo "run sharkstore test....."

  - cd ${PROJECT_DIR}/data-server/build/test
  - echo $PWD
  - ./range_ddl_unittest
  - ./range_meta_unittest
  - ./range_raw_unittest
  - ./range_sql_unittest
  - ./store_unittest

  - echo "done"

test_sharkstore_gs:
  stage: test
  script:
  - echo "run sharkstore test....."
  - echo "java -test"
  - echo "done"

deploy_sharkstore:
  stage: deploy
  script:
  - echo "deploy sharkstore...."
  - echo "run mvn install"
  - echo "done"

